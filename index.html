<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulário de Ocorrência</title>
  <style>
    body {
      font-family: Roboto, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: #202124;
    }
    h1 {
      text-align: center;
      padding: 20px 0;
      font-size: 24px;
    }
    form, .controls {
      max-width: 480px;
      margin: 20px auto;
      padding: 24px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(60,64,67,0.3);
      box-sizing: border-box;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: 500;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      padding: 20px;
    }
    button {
      background-color: #d93025;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
      flex: 1 1 45%;
      max-width: 200px;
    }
    button:hover {
      background-color: #c5221f;
    }
    #dadosAdicionadosWrapper, #visualizacao {
      max-width: 480px;
      margin: 20px auto;
      background-color: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(60,64,67,0.3);
      box-sizing: border-box;
    }
    #dadosAdicionadosWrapper {
      overflow-x: auto;
      overflow-y: auto;
      max-height: 300px;
    }
    #dadosAdicionados {
      display: block;
      min-width: 600px; /* Garante espaço para overflow horizontal */
      white-space: nowrap;
    }
    #visualizacao {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
    }
    #visualizacao .item {
      background: #f1f3f4;
      padding: 10px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      text-align: left;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
    }
    th, td {
      border: 1px solid #dadce0;
      padding: 8px;
      text-align: left;
      white-space: nowrap;
    }
    th {
      background-color: #f1f3f4;
    }
    .button-wrapper {
      text-align: center;
      margin-bottom: 20px;
    }
    .button-wrapper button {
      margin-top: 10px;
      background-color: #d93025;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Registro de Ocorrência</h1>
  <form>
    <div class="button-wrapper">
      <button type="button" onclick="obterCoordenadas()">Obter Coordenadas, Data e Hora</button>
    </div>
    <label>Latitude:</label><input type="text" id="latitude" readonly>
    <label>Longitude:</label><input type="text" id="longitude" readonly>
    <label>Data:</label><input type="text" id="data" readonly>
    <label>Hora:</label><input type="text" id="hora" readonly>
    <label>Nome:</label><input type="text" id="nome">
    <label>Data de Nascimento:</label><input type="date" id="dataNascimento">
    <label>Profissão:</label>
    <select id="profissao" onchange="atualizarAtuacaoSituacao()">
      <option value="">Selecione</option>
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
    </select>
    <label>Atuação:</label><input type="text" id="atuacao" readonly>
    <label>Situação:</label><input type="text" id="situacao" readonly>
    <label>Endereço:</label><input type="text" id="endereco">
    <label>RE do Militar:</label><input type="text" id="reMilitar" onchange="preencherDadosMilitar()">
    <label>Nome do Militar:</label><input type="text" id="nomeMilitar" readonly>
    <label>Posto/Graduação:</label><input type="text" id="postoGraduacao" readonly>
    <label>OPM:</label><input type="text" id="opm" readonly>
  </form>
  <div class="controls">
    <button type="button" onclick="visualizarDados()">Visualizar</button>
    <button type="button" onclick="adicionarDados()">Adicionar</button>
    <button type="button" onclick="exportarParaExcel()">Exportar Excel</button>
    <button type="button" onclick="confirmarLimparFormulario()">Limpar Formulário</button>
    <button type="button" onclick="confirmarLimparDados()">Limpar Dados Adicionados</button>
  </div>
  <div id="visualizacao"></div>
  <div id="dadosAdicionadosWrapper"><div id="dadosAdicionados"></div></div>
  <script>
    function obterCoordenadas() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          document.getElementById('latitude').value = pos.coords.latitude.toFixed(6);
          document.getElementById('longitude').value = pos.coords.longitude.toFixed(6);
        });
      }
      const agora = new Date();
      document.getElementById('data').value = agora.toLocaleDateString();
      document.getElementById('hora').value = agora.toLocaleTimeString();
    }
    function atualizarAtuacaoSituacao() {
      const profissao = document.getElementById('profissao').value;
      const atuacao = document.getElementById('atuacao');
      const situacao = document.getElementById('situacao');
      if (profissao === 'A') {
        atuacao.value = 'Área A';
        situacao.value = 'Ativo';
      } else if (profissao === 'B') {
        atuacao.value = 'Área B';
        situacao.value = 'Licenciado';
      } else if (profissao === 'C') {
        atuacao.value = 'Área C';
        situacao.value = 'Inativo';
      } else {
        atuacao.value = '';
        situacao.value = '';
      }
    }
    function preencherDadosMilitar() {
      const re = document.getElementById('reMilitar').value;
      const dados = {
        '123456': { nome: 'João Silva', posto: 'Sargento', opm: '1º BPM' },
        '654321': { nome: 'Maria Souza', posto: 'Tenente', opm: '2º BPM' }
      };
      const dadosMilitar = dados[re] || { nome: '', posto: '', opm: '' };
      document.getElementById('nomeMilitar').value = dadosMilitar.nome;
      document.getElementById('postoGraduacao').value = dadosMilitar.posto;
      document.getElementById('opm').value = dadosMilitar.opm;
    }
    function visualizarDados() {
      const dados = coletarDados();
      let html = '';
      for (let chave in dados) {
        html += `<div class="item"><strong>${chave}:</strong><br>${dados[chave]}</div>`;
      }
      document.getElementById('visualizacao').innerHTML = html;
    }
    function adicionarDados() {
      const dados = coletarDados();
      let html = '<table><thead><tr>';
      for (let chave in dados) {
        html += `<th>${chave}</th>`;
      }
      html += '</tr></thead><tbody><tr>';
      for (let chave in dados) {
        html += `<td>${dados[chave]}</td>`;
      }
      html += '</tr></tbody></table>';
      document.getElementById('dadosAdicionados').innerHTML += html;
    }
    function exportarParaExcel() {
      let tabela = document.getElementById('dadosAdicionados').innerHTML;
      let win = window.open('', '', 'height=700,width=700');
      win.document.write('<html><head><title>Exportar Excel</title>');
      win.document.write('<meta charset="UTF-8"></head><body>');
      win.document.write(tabela);
      win.document.write('</body></html>');
      win.document.close();
      win.print();
    }
    function confirmarLimparFormulario() {
      if (confirm('Deseja realmente limpar o formulário?')) {
        document.querySelector('form').reset();
        document.getElementById('atuacao').value = '';
        document.getElementById('situacao').value = '';
      }
    }
    function confirmarLimparDados() {
      if (confirm('Deseja realmente limpar os dados adicionados?')) {
        document.getElementById('dadosAdicionados').innerHTML = '';
        document.getElementById('visualizacao').innerHTML = '';
      }
    }
    function coletarDados() {
      return {
        Latitude: document.getElementById('latitude').value,
        Longitude: document.getElementById('longitude').value,
        Data: document.getElementById('data').value,
        Hora: document.getElementById('hora').value,
        Nome: document.getElementById('nome').value,
        "Data de Nascimento": document.getElementById('dataNascimento').value,
        Profissão: document.getElementById('profissao').value,
        Atuação: document.getElementById('atuacao').value,
        Situação: document.getElementById('situacao').value,
        Endereço: document.getElementById('endereco').value,
        "RE do Militar": document.getElementById('reMilitar').value,
        "Nome do Militar": document.getElementById('nomeMilitar').value,
        "Posto/Graduação": document.getElementById('postoGraduacao').value,
        OPM: document.getElementById('opm').value
      };
    }
  </script>
</body>
</html>
